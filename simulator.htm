<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IoT Simulator (Thiáº¿t bá»‹ áº£o)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f0f0; }
        .status-box { 
            background: white; padding: 20px; border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto;
        }
        h2 { text-align: center; color: #2c3e50; }
        .log { font-family: monospace; color: #d63031; margin-top: 10px; }
        button { 
            display: block; width: 100%; padding: 10px; margin-top: 20px;
            background: #0984e3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;
        }
        button:hover { background: #74b9ff; }
        button.stop { background: #d63031; }
    </style>
</head>
<body>

    <div class="status-box">
        <h2>ğŸŒ¡ï¸ Giáº£ láº­p dá»¯ liá»‡u IoT</h2>
        <p>Tráº¡ng thÃ¡i: <b id="status" style="color: red;">Äang dá»«ng</b></p>
        <div id="values">
            <p>Nhiá»‡t Ä‘á»™: --</p>
            <p>Äá»™ áº©m KK: --</p>
            <p>Äá»™ áº©m Ä‘áº¥t: --</p>
            <p>Ãnh sÃ¡ng: --</p>
        </div>
        <button id="toggleBtn" onclick="toggleSimulation()">Báº¯t Ä‘áº§u giáº£ láº­p</button>
        <p class="log" id="logMsg"></p>
    </div>

    <script type="module">
        // 1. Cáº¥u hÃ¬nh Firebase (Y há»‡t project cá»§a báº¡n)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBr7tBAHwXaGBL0ceLK9c1UDSdYRq_cuZs",
            authDomain: "project-greenhouse-5970e.firebaseapp.com",
            databaseURL: "https://project-greenhouse-5970e-default-rtdb.firebaseio.com",
            projectId: "project-greenhouse-5970e",
            storageBucket: "project-greenhouse-5970e.firebasestorage.app",
            messagingSenderId: "476065711518",
            appId: "1:476065711518:web:fb1e3df380f3b24cfac28f",
            measurementId: "G-4YTZQB881G"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Biáº¿n kiá»ƒm soÃ¡t vÃ²ng láº·p
        let intervalId = null;
        let isRunning = false;

        // HÃ m sinh sá»‘ ngáº«u nhiÃªn trong khoáº£ng (min, max)
        function getRandom(min, max, isFloat = false) {
            const num = Math.random() * (max - min) + min;
            return isFloat ? num.toFixed(1) : Math.floor(num);
        }

        // HÃ m gá»­i dá»¯ liá»‡u lÃªn Firebase
        window.startSim = function() {
            const statusText = document.getElementById('status');
            const logMsg = document.getElementById('logMsg');
            const valuesDiv = document.getElementById('values');

            statusText.innerText = "Äang cháº¡y dá»¯ liá»‡u thá»±c...";
            statusText.style.color = "green";

            // CHáº Y VÃ’NG Láº¶P Gá»¬I DATA SAU Má»–I 3 GIÃ‚Y
            intervalId = setInterval(() => {
                // 1. Táº¡o dá»¯ liá»‡u giáº£ ngáº«u nhiÃªn
                const fakeTemp = getRandom(28, 35, true);   // Nhiá»‡t Ä‘á»™: 28 - 35 Ä‘á»™
                const fakeHum = getRandom(60, 90);          // Äá»™ áº©m: 60 - 90 %
                const fakeSoil = getRandom(40, 80);         // Äáº¥t: 40 - 80 %
                const fakeLight = getRandom(100, 1000);     // Ãnh sÃ¡ng: 100 - 1000 lux

                // 2. Gá»­i lÃªn Firebase (DÃ¹ng hÃ m set Ä‘á»ƒ ghi Ä‘Ã¨ giÃ¡ trá»‹ cÅ©)
                // LÆ°u Ã½: ÄÆ°á»ng dáº«n pháº£i khá»›p vá»›i web chÃ­nh: Green_house/temp, hum, soil_hum, light
                set(ref(db, 'Green_house/temp'), parseFloat(fakeTemp));
                set(ref(db, 'Green_house/hum'), parseInt(fakeHum));
                set(ref(db, 'Green_house/soil_hum'), parseInt(fakeSoil));
                set(ref(db, 'Green_house/light'), parseInt(fakeLight));

                // 3. Hiá»ƒn thá»‹ log chÆ¡i cho vui
                valuesDiv.innerHTML = `
                    <p>Nhiá»‡t Ä‘á»™: ${fakeTemp}Â°C</p>
                    <p>Äá»™ áº©m KK: ${fakeHum}%</p>
                    <p>Äá»™ áº©m Ä‘áº¥t: ${fakeSoil}%</p>
                    <p>Ãnh sÃ¡ng: ${fakeLight} lux</p>
                `;
                logMsg.innerText = `ÄÃ£ gá»­i lÃºc ${new Date().toLocaleTimeString()}`;

            }, 3000); // 3000ms = 3 giÃ¢y gá»­i 1 láº§n
        }

        window.stopSim = function() {
            clearInterval(intervalId);
            const statusText = document.getElementById('status');
            statusText.innerText = "ÄÃ£ dá»«ng";
            statusText.style.color = "red";
        }

        // Gáº¯n hÃ m vÃ o window Ä‘á»ƒ nÃºt báº¥m HTML gá»i Ä‘Æ°á»£c (do type="module")
        window.toggleSimulation = function() {
            const btn = document.getElementById('toggleBtn');
            if (!isRunning) {
                window.startSim();
                btn.innerText = "Dá»«ng giáº£ láº­p";
                btn.classList.add('stop');
                isRunning = true;
            } else {
                window.stopSim();
                btn.innerText = "Báº¯t Ä‘áº§u giáº£ láº­p";
                btn.classList.remove('stop');
                isRunning = false;
            }
        }
    </script>
</body>
</html>